Installation
============

Prerequisites
-------------

- Docker
- Python 3.10+
- `Factorio <https://www.factorio.com/>`_ (version 1.1.110), only for optional rendering

Installation
------------

Core FLE SDK package:

.. code-block:: bash

   pip install factorio-learning-environment
   uv add factorio-learning-environment

With optional features:

.. code-block:: bash

   # For running experiments
   pip install factorio-learning-environment[eval]
   
   # For MCP protocol support  
   pip install factorio-learning-environment[mcp]
   
   # For PostgreSQL support
   pip install factorio-learning-environment[psql]
   
   # All features
   pip install factorio-learning-environment[eval,mcp,psql]

Using uv (recommended):

.. code-block:: bash

   uv add factorio-learning-environment[eval]

Client-side Setup (Optional)
----------------------------

For rendering graphics, set up the Factorio client:

1. **Set up Factorio client**:
   - Purchase Factorio from the `official website <https://www.factorio.com/>`_ (recommended) or on Steam.
   - Downgrade to version 1.1.110:
     - Steam: Right-click Factorio → Properties → Betas → Select 1.1.110
     - **Important**: Make sure to uncheck the Space Age DLC if you have it, as it forces the 2.x branch

2. **Activate server**:
   - Open Factorio client
   - Navigate to _Multiplayer_
   - Connect to `localhost:34197` (default) or your configured address in Docker.
     - Once connected, you can safely disconnect. This step confirms your Factorio license with the server.

API Key Configuration
---------------------

FLE supports multiple LLM providers for agent evaluation. To get started with API keys:

1. **Quick Setup** (Recommended):
   .. code-block:: bash

      python fle/eval/infra/setup_api_keys.py

   This interactive script helps you:
   - Configure API keys for OpenAI, Anthropic, and other providers
   - Set up API key rotation for high-volume experiments
   - Generate provider-specific configuration files
   - Validate your API key setup

2. **Manual Setup**:
   Add your API keys to the `.env` file:
   .. code-block:: bash

      # OpenAI
      OPENAI_API_KEY=sk-...
      
      # Anthropic
      ANTHROPIC_API_KEY=sk-ant-...
      
      # Additional providers as needed

3. **Advanced Configuration**:
   For large-scale experiments, you can set up API key rotation and provider-specific settings using the configuration files generated by `setup_api_keys.py`.

Troubleshooting
---------------

- **"No valid programs found for version X"**: This is normal during initialization. The system will start generating programs shortly.
- **Database connection errors**: Verify your database configuration in the .env file and ensure the database exists.
- **API key errors**: Run `python fle/eval/infra/setup_api_keys.py` to verify your API key configuration.
- **Docker issues**: Ensure your user has permission to run Docker without sudo.
- **Connection issues**: Make sure the Factorio server is running and ports are properly configured.

Building Documentation (Maintainers)
------------------------------------

Install Sphinx tooling:

.. code-block:: bash

   pip install sphinx sphinx-rtd-theme sphinx-autodoc-typehints

Build the HTML documentation:

.. code-block:: bash

   cd factorio-learning-environment/docs/sphinx && python -m sphinx -b html source build/html

The generated site will be in ``docs/sphinx/build/html``.
